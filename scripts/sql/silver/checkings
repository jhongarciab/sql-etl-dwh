-- CRM Sources
-- Cost info
-- Check for nulls and duplicates in primary key
SELECT cst_id, COUNT(*) FROM silver.crm_cust_info
GROUP BY cst_id HAVING COUNT(*) > 1 OR cst_id IS NULL;

-- Unwanted spaces in strings characters 
SELECT cst_firstname, cst_lastname, cst_material_status, cst_gndr FROM silver.crm_cust_info
WHERE TRIM(cst_firstname) != cst_firstname
   OR TRIM(cst_lastname) != cst_lastname
   OR TRIM(cst_material_status) != cst_material_status
  OR TRIM(cst_gndr) != cst_gndr

-- Data standarization and consistency
SELECT DISTINCT cst_gndr FROM bronze.crm_cust_info;
SELECT DISTINCT cst_material_status FROM bronze.crm_cust_info;

SELECT * FROM silver.crm_cust_info;

-- Product info
-- Check for nulls and duplicates in primary key
SELECT prd_id, COUNT(*) FROM silver.crm_prd_info
GROUP BY prd_id HAVING COUNT(*) > 1 OR prd_id IS NULL;

-- Unwanted spaces in strings characters 
SELECT prd_nm FROM silver.crm_prd_info
WHERE TRIM(prd_nm) != prd_nm;


-- Check nulls or negative numbers
SELECT prd_cost FROM silver.crm_prd_info
WHERE prd_cost IS NULL OR prd_cost < 0;

-- Data standarization and consistency
SELECT DISTINCT prd_line FROM silver.crm_prd_info;

-- Check invalid date orders
SELECT * FROM silver.crm_prd_info
WHERE prd_end_dt < prd_start_dt;

SELECT * FROM silver.crm_prd_info;

-- Sales details
-- Check for invalid dates
SELECT 
NULLIF(sls_order_dt, 0) FROM silver.crm_sales_details
WHERE sls_order_dt <= 0 OR LENGTH(CAST(sls_order_dt AS TEXT)) != 8;

-- Check for invalid date orders
SELECT * FROM silver.crm_sales_details
WHERE sls_order_dt > sls_ship_dt OR sls_order_dt > sls_due_dt;

-- Business rules validation
SELECT DISTINCT
sls_sales,
sls_quantity,
sls_price
FROM silver.crm_sales_details
WHERE sls_sales != sls_quantity * sls_price
OR sls_sales IS NULL
OR sls_quantity IS NULL
OR sls_price IS NULL
OR sls_sales <= 0 
OR sls_quantity <= 0
OR sls_price <= 0
ORDER BY sls_sales, sls_quantity, sls_price;

SELECT * FROM silver.crm_sales_details;

-- ERP Sources
-- Cid info
-- Identify out of range dates
SELECT DISTINCT bdate FROM silver.erp_cust_az12
WHERE bdate < TO_DATE('1925-01-01', 'YYYY-MM-DD')
   OR bdate > CURRENT_DATE;

-- Data Standardization and consistency
SELECT DISTINCT 
gen
FROM silver.erp_cust_az12;

SELECT * FROM silver.erp_cust_az12;

-- Loc info
SELECT 
cid,
cntry
FROM silver.erp_loc_a101;

-- Data standardization and consistency
SELECT DISTINCT
cntry 
FROM silver.erp_loc_a101 
ORDER BY cntry;

SELECT * FROM silver.erp_loc_a101;

-- Cat info
SELECT 
id,
cat,
subcat,
mainteance
FROM silver.erp_px_cat_g1v2;
*/
-- Cheack for unwanted spaces in string characters
SELECT * FROM silver.erp_px_cat_g1v2
WHERE TRIM(cat) != cat
  OR TRIM(subcat) != subcat
  OR TRIM(mainteance) != mainteance;

-- Data standardization and consistency
SELECT DISTINCT
cat,
subcat,
mainteance
FROM silver.erp_px_cat_g1v2;

SELECT * FROM silver.erp_px_cat_g1v2;